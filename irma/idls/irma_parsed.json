{
  "version": "0.1.0",
  "name": "irma",
  "docs": [
    "IRMA program",
    "Use OpenBook V2 to process events and update the IRMA state, including pricing."
  ],
  "instructions": [
    {
      "name": "initialize",
      "docs": [
        "This is a one-time operation that sets up the IRMA pricing module.",
        "Assume that the markets for the initial IRMA / reserve stablecoin pairs already exist.",
        "This iniatializes only the pricing module for the intial stablecoin reserves, nothing else.",
        "The \"Init\" data is allocated in a data account that is owned by the IRMA program.",
        "The data is pre-allocated before the call, but empty."
      ],
      "accounts": [
        {
          "name": "state",
          "isMut": true,
          "isSigner": false
        },
        {
          "name": "irmaAdmin",
          "isMut": true,
          "isSigner": true
        },
        {
          "name": "systemProgram",
          "isMut": false,
          "isSigner": false
        }
      ],
      "args": []
    },
    {
      "name": "addStablecoin",
      "docs": [
        "Add a new stablecoin to the reserves.",
        "This is a permissioned instruction that can only be called by the IRMA program owner.",
        "The minimum requirement is that the stablecoin has 100M circulating supply and is not a meme coin.",
        "IRMA relies on pre-existing network effects of each of the reserve stablecoins."
      ],
      "accounts": [
        {
          "name": "state",
          "isMut": true,
          "isSigner": false
        },
        {
          "name": "irmaAdmin",
          "isMut": true,
          "isSigner": true
        },
        {
          "name": "systemProgram",
          "isMut": false,
          "isSigner": false
        }
      ],
      "args": [
        {
          "name": "symbol",
          "type": "string"
        },
        {
          "name": "mintAddress",
          "type": "publicKey"
        },
        {
          "name": "decimals",
          "type": "u8"
        }
      ]
    },
    {
      "name": "removeStablecoin",
      "docs": [
        "Remove a stablecoin from the reserves by its symbol.",
        "WARNING: This actually removes the stablecoin from the reserves, so be careful when using it.",
        "In order to continue to avoid runs, all reserve amount must be redeemed before removing a stablecoin.",
        "This can be done without using much capital: use 100K IRMAs to redeem another stablecoin (B),",
        "then disable or deactivate the stablecoin to be removed (A), and then do a loop of",
        "1. internally swapping 100k of stablecoin B for stablecoin A, and then",
        "2. externally swapping 100k of stablecoin A for 100k of stablecoin B (open market)."
      ],
      "accounts": [
        {
          "name": "state",
          "isMut": true,
          "isSigner": false
        },
        {
          "name": "irmaAdmin",
          "isMut": true,
          "isSigner": true
        },
        {
          "name": "systemProgram",
          "isMut": false,
          "isSigner": false
        }
      ],
      "args": [
        {
          "name": "symbol",
          "type": "string"
        }
      ]
    },
    {
      "name": "disableReserve",
      "docs": [
        "Deactivate a reserve stablecoin.",
        "Deactivating should still include the stablecoin in all calculations.",
        "The only action that is disabled should be the minting of IRMA using this reserve stablecoin.",
        "This is done in preparation for removing the stablecoin from the reserves.",
        "For orderly removal, first announce separate dates of deactivation and removal."
      ],
      "accounts": [
        {
          "name": "state",
          "isMut": true,
          "isSigner": false
        },
        {
          "name": "irmaAdmin",
          "isMut": true,
          "isSigner": true
        },
        {
          "name": "systemProgram",
          "isMut": false,
          "isSigner": false
        }
      ],
      "args": [
        {
          "name": "symbol",
          "type": "string"
        }
      ]
    },
    {
      "name": "crank",
      "docs": [
        "Crank the OpenBook V2 from client.",
        "This function is called periodically (at least once per slot) to process events and update the IRMA state."
      ],
      "accounts": [
        {
          "name": "state",
          "isMut": true,
          "isSigner": false
        },
        {
          "name": "irmaAdmin",
          "isMut": true,
          "isSigner": true
        },
        {
          "name": "systemProgram",
          "isMut": false,
          "isSigner": false
        }
      ],
      "args": []
    }
  ],
  "accounts": [
    {
      "name": "StateMap",
      "type": {
        "kind": "struct",
        "fields": [
          {
            "name": "reserves",
            "type": {
              "vec": {
                "defined": "StableState"
              }
            }
          },
          {
            "name": "bump",
            "type": "u8"
          },
          {
            "name": "padding",
            "type": {
              "array": [
                "u8",
                7
              ]
            }
          }
        ]
      }
    },
    {
      "name": "State",
      "type": {
        "kind": "struct",
        "fields": [
          {
            "name": "pubkey",
            "type": "publicKey"
          },
          {
            "name": "mintPrice",
            "type": "f64"
          },
          {
            "name": "lastUpdated",
            "type": "i64"
          },
          {
            "name": "lamports",
            "type": "u64"
          },
          {
            "name": "stablecoin",
            "type": "u8"
          },
          {
            "name": "padding1",
            "type": {
              "array": [
                "u8",
                7
              ]
            }
          },
          {
            "name": "bump",
            "type": "u8"
          },
          {
            "name": "padding2",
            "type": {
              "array": [
                "u8",
                7
              ]
            }
          }
        ]
      }
    }
  ],
  "types": [
    {
      "name": "StableState",
      "docs": [
        "Alternative implementation that allows for easy addition of new stablecoins",
        "Each stablecoin struct uses 80 bytes."
      ],
      "type": {
        "kind": "struct",
        "fields": [
          {
            "name": "symbol",
            "type": "string"
          },
          {
            "name": "mintAddress",
            "type": "publicKey"
          },
          {
            "name": "backingDecimals",
            "type": "u64"
          },
          {
            "name": "mintPrice",
            "type": "f64"
          },
          {
            "name": "backingReserves",
            "type": "u64"
          },
          {
            "name": "irmaInCirculation",
            "type": "u64"
          },
          {
            "name": "active",
            "type": "bool"
          },
          {
            "name": "extra",
            "type": {
              "array": [
                "u8",
                7
              ]
            }
          }
        ]
      }
    }
  ],
  "errors": [
    {
      "code": 6000,
      "name": "InvalidAmount",
      "msg": "Invalid amount provided."
    },
    {
      "code": 6001,
      "name": "MintPriceNotSet",
      "msg": "Mint price not set."
    },
    {
      "code": 6002,
      "name": "InvalidQuoteToken",
      "msg": "Invalid quote token."
    },
    {
      "code": 6003,
      "name": "InsufficientCirculation",
      "msg": "Insufficient circulation."
    },
    {
      "code": 6004,
      "name": "InsufficientReserve",
      "msg": "Insufficient reserve."
    },
    {
      "code": 6005,
      "name": "InvalidBacking",
      "msg": "Invalid reserve value."
    },
    {
      "code": 6006,
      "name": "InvalidIrmaAmount",
      "msg": "Invalid IRMA amount."
    },
    {
      "code": 6007,
      "name": "InvalidReserveList",
      "msg": "No reserve list."
    },
    {
      "code": 6008,
      "name": "InvalidBackingSymbol",
      "msg": "Invalid backing symbol."
    },
    {
      "code": 6009,
      "name": "InvalidBackingAddress",
      "msg": "Invalid backing address."
    },
    {
      "code": 6010,
      "name": "SymbolNotFound",
      "msg": "Symbol not found."
    }
  ]
}